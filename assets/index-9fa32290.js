(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?s.credentials="include":e.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(e){if(e.ep)return;e.ep=!0;const s=n(e);fetch(e.href,s)}})();const c={board:document.querySelector(".board"),boardContainer:document.querySelector(".board-container"),win:document.querySelector(".win"),card:document.querySelector(".card"),canvas:document.getElementById("canvas"),dimensions:document.querySelector(".board").dataset.dimension},a={flippedCards:0,totalFlips:0,loop:null,imageParts:[],id:0},A=t=>{if(!t||!Array.isArray(t))throw new Error("Передайте значения в виде массива!");const n=[...t.sort(()=>Math.random(t)-.5)].slice(0,8),r=[...n,...n];return r.sort(()=>Math.random(r)-.5)},L=()=>{a.flippedCards++,a.totalFlips++},g=()=>a.flippedCards=0,S=()=>a.flippedCards<2,h=()=>a.flippedCards===2,E=t=>t.classList.add("flipped"),T=()=>{const t=document.querySelectorAll(".flipped:not(.matched)");t[0].innerText===t[1].innerText?w(t):setTimeout(()=>{I()},1e3)},w=t=>{t.forEach(o=>o.classList.add("matched")),h()&&g(),F(t)},I=()=>{document.querySelectorAll(".card:not(.matched)").forEach(o=>o.classList.remove("flipped")),g()},M=()=>!document.querySelectorAll(".card:not(.flipped)").length,P=()=>{c.boardContainer.classList.add("flipped"),c.win.innerHTML=`
      <span class="win-text">
        Игра успешно пройдена!<br />
        количество шагов: <span class="highlight">${a.totalFlips}</span><br />
      </span>
    `,clearInterval(a.loop)},F=t=>{t.forEach(o=>{let n=o.getAttribute("id");setTimeout(()=>{const r=`
      <img src = ${a.imageParts[n]} class='partImage'></img>`;o.insertAdjacentHTML("beforeend",r)},1e3)})},O=()=>{const t=getComputedStyle(c.board),o=document.querySelectorAll(".partImage");let n=parseFloat(t.gridGap);const r=setInterval(()=>{n-=.5,n<=0&&(n=0,clearInterval(r)),c.board.style.gridGap=`${n}px`,o.forEach(e=>e.style.borderRadius="0px")},50);setTimeout(()=>P(),4e3)},q=()=>{if(c.dimensions%2!==0)throw new Error("Размер игрового поля должен быть четным!");const r=A(["1","2","3","4","5","6","7","8","9","10"]).map(e=>`
        <div class='card' id=${a.id++}>
            <div class='card-back'></div>
            <div class='card-front'>${e}</div>
        </div>`).join("");c.board.insertAdjacentHTML("beforeend",r)},x=t=>{S()&&E(t),L(),h()&&T(),M()&&setTimeout(()=>{O()},1e3)},D=t=>{const n=t.target.parentElement;n.classList.contains("card")&&!n.classList.contains("flipped")&&x(n)},H=t=>{const o=c.canvas,n=c.dimensions,r=o.getContext("2d"),e=new Image;e.crossOrigin="anonymous",e.src=t,e.onload=()=>{const s=e.width,i=e.height;o.width=s,o.height=i,r.drawImage(e,0,0,s,i);const l=s/n,p=i/n;let f=[];for(let u=0;u<n;u++)for(let m=0;m<n;m++){const y=m*l,C=u*p,b=r.getImageData(y,C,l,p),d=document.createElement("canvas"),v=d.getContext("2d");d.width=l,d.height=p,v.putImageData(b,0,0),f.push(d.toDataURL())}a.imageParts=[...f]}};document.addEventListener("DOMContentLoaded",()=>{H("./src/img/background_сard.jpg"),q(),document.addEventListener("click",D)});
